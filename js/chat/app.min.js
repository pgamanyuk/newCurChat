document.addEventListener("DOMContentLoaded",e=>{let t=45,s=0,a="";const n=document.querySelector("#hamburger"),i=document.querySelector("#chatInput"),c=document.querySelector("#chatArea"),l=document.querySelectorAll("#chatBtn"),o=document.querySelector("#loader"),d=io("https://stark-lake-56522.herokuapp.com/"),r=document.querySelector(".header"),m=document.querySelector(".sidebar__items"),g=document.querySelectorAll(".header__icon-img"),h=document.querySelectorAll(".sidebar__item-title"),_=document.querySelectorAll(".sidebar__item-icon"),v=document.querySelector(".fade__page"),u=document.querySelector("body"),y=document.querySelector(".chat__tabs");function f(e){return e<10?"0"+e:e}function p(){axios.post("https://stark-lake-56522.herokuapp.com/decodejwt",{token:localStorage.getItem("token")}).then((function(e){var t;a=e.data.login,t=e.data.login,axios.post("https://stark-lake-56522.herokuapp.com/renderRecentMessages",{login:t+"chats"}).then((function(e){let t;e.data.messages.reverse(),t=e.data.messages.length>=200?200:e.data.messages.length;for(let s=t-1;s>=0;s--){const t=e.data.messages[s],a=f(new Date(t.date).getHours()),n=f(new Date(t.date).getMinutes()),i=f(new Date(t.date).getMonth()+1),c=`${f(new Date(t.date).getDate())}.${i}`,l=`${a}:${n}`;I(t.sender,c,l,t.message)}o.classList.toggle("hide"),c.scrollBy(0,c.scrollHeight)})).catch((function(e){alert(e)})),d.on("chat message",(async function(e){const t=f(new Date(e.date).getHours()),s=f(new Date(e.date).getMinutes()),a=f(new Date(e.date).getMonth()+1),n=`${f(new Date(e.date).getDate())}.${a}`,i=`${t}:${s}`;await I(e.sender,n,i,e.message),c.scrollBy(0,c.scrollHeight)})),d.emit("chat message",{message:"systemConnectionCheckBIBA",login:a})})).catch((function(e){alert(e)}))}async function I(e,t,s,a){if("admin"===e){let n=document.createElement("div");n.setAttribute("class","messageItem"),n.classList.add("adminItem"),n.innerHTML=`\n        \n        <div class="messageItem__container-admin">\n            <div class="messageItem__avatar">\n                <img class="messageItem__avatar-img admin__img" src="../img/chat/admin.svg" alt="">\n            </div>\n            <div class="messageItem__content">\n                <div class="messageItem__info">\n                    <div class="messageItem__name">${e}</div>\n                    <div class="messageItem__date">${t}</div>\n                </div>\n                <div class="messageItem__text">${a}</div>\n            </div>\n            <div class="messageItem__hours">${s}</div>\n        </div>\n        `,c.append(n),n=""}else{let n=document.createElement("div");n.setAttribute("class","messageItem"),n.innerHTML=`\n        \n        <div class="messageItem__container">\n            <div class="messageItem__avatar">\n                <img class="messageItem__avatar-img" src="../img/chat/profile.svg" alt="">\n            </div>\n            <div class="messageItem__content">\n                <div class="messageItem__info">\n                    <div class="messageItem__name">${e}</div>\n                    <div class="messageItem__date">${t}</div>\n                </div>\n                <div class="messageItem__text">${a}</div>\n            </div>\n            <div class="messageItem__hours">${s}</div>\n        </div>\n        `,c.append(n),n=""}}axios.post("https://stark-lake-56522.herokuapp.com/checkjwt",{token:localStorage.getItem("token")}).then((function(e){e.data.message?location.href="../signin/signin.html":p()})).catch((function(e){alert(e)})),document.querySelectorAll("#active__sidebar").forEach(e=>{"3"===e.getAttribute("number")&&(e.innerHTML="{ Чат }",e.style.fontWeight="700",e.style.color="#fff")}),n.addEventListener("click",e=>{n.classList.toggle("open-menu"),n.classList.contains("open-menu")?function(){let e=65;v.style.display="block",window.screen.width<=768&&(u.style.overflow="hidden");const t=setInterval(()=>{80==e&&v.classList.add("show__fadePage"),260===e?clearInterval(t):(e+=15,m.style.width=e+"px"),245===e&&(h.forEach(e=>{e.style.display="block"}),_.forEach(e=>{e.style.marginRight="20"}))},20)}():function(){let e=260;v.classList.remove("show__fadePage"),v.style.display="none",u.style.overflow="unset",h.forEach(e=>{e.style.display="none"}),_.forEach(e=>{e.style.marginRight="0"});const t=setInterval(()=>{65===e?clearInterval(t):(e-=15,m.style.width=e+"px")},20)}()}),window.addEventListener("scroll",e=>{pageYOffset>=50?(r.classList.add("header__inmove"),g.forEach(e=>{e.classList.add("header__inmoveicon")})):(r.classList.remove("header__inmove"),g.forEach(e=>{e.classList.remove("header__inmoveicon")}))}),function(){for(let e=0;e<5;e++)y.innerHTML+='\n          \n              <div class="chat__tabs-item">\n                  <div class="chat__tabs-itemText">Шакал</div>\n                  <img src="../img/chat/hashtag-2.png" class="chat__tabs-itemImg">\n              </div>\n          ';const e=document.querySelectorAll(".chat__tabs-item"),t=document.querySelectorAll(".chat__tabs-itemImg");e.forEach((e,s)=>{0==s&&(e.classList.add("active__tab"),t[0].classList.add("active__tab-img")),e.style.cssText="\n          margin-right: 10px;\n          "})}(),function(){const e=document.querySelectorAll(".chat__tabs-item"),t=document.querySelectorAll(".chat__tabs-itemImg");e.forEach((s,a)=>{s.addEventListener("click",()=>{e.forEach(e=>{e.classList.remove("active__tab")}),t.forEach(e=>{e.classList.remove("active__tab-img")}),s.classList.add("active__tab"),t[a].classList.add("active__tab-img")})})}(),autosize(i),i.addEventListener("input",e=>{t<+i.style.height.slice(0,-2)&&s<=6&&(s+=1,t=+i.style.height.slice(0,-2),c.style.minHeight=c.clientHeight-23+15+"px",c.style.height=c.clientHeight-23+15+"px"),t>+i.style.height.slice(0,-2)&&(t-=23,s-=1,c.style.minHeight=c.clientHeight+23+15+"px"),45==+i.style.height.slice(0,-2)&&(c.style.height="70vh",c.style.minHeight="70vh",t=45,s=0)}),l.forEach(e=>{e.addEventListener("click",e=>{i.value&&(d.emit("chat message",{message:i.value.replaceAll("\n","<br>"),login:a}),console.log(i.value),i.value="",i.style.height="45px",c.style.height="70vh")})}),document.addEventListener("keydown",e=>{"Enter"!==e.code||e.shiftKey?"Enter"===e.code&&e.shiftKey:(e.preventDefault(),i.value&&(d.emit("chat message",{message:i.value.replaceAll("\n","<br>"),login:a}),i.value="",i.style.height="45px",c.style.height="70vh",e.preventDefault()))})});